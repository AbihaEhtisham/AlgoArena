<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Connect4 - AI Progress Report</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/report.css') }}" />
  </head>

  <body class="gr-body">
    <div class="gr-wrap gr-anim-in">
      <!-- Header -->
      <header class="gr-header">
        <div class="gr-brand">
          <div class="gr-badge">
            <img
              class="gr-robo"
              src="{{ url_for('static', filename='assets/icons/robo_icon.png') }}"
              alt="AI"
            />
          </div>

          <div class="gr-title">
            <h1>AI Progress Report</h1>
            <p>Multi-agent analysis of the Connect4 learning AI</p>
          </div>
        </div>

        <div class="gr-actions">
          <a class="gr-btn gr-btn-ghost" href="{{ url_for('connect4') }}">Play Again</a>
          <a class="gr-btn gr-btn-primary" href="{{ url_for('index') }}">Main Menu</a>
        </div>
      </header>

      <!-- Hero summary -->
      <section class="gr-hero">
        <div>
          <div class="gr-hero-k">Session summary</div>

          <div class="gr-pill-row">
            <div class="gr-pill"><b>Games:</b> {{ report.games_played }}</div>
            <div class="gr-pill"><b>Win rate:</b> {{ report.ai_win_rate }}%</div>

            {% if report.last_result %}
              {% set lr = report.last_result | lower %}
              {% if lr == "ai" or lr == "ai won" or lr == "ai_win" or lr == "win" %}
                <div class="gr-pill"><span class="gr-badge gr-badge-ok">Last Result: AI WON</span></div>
              {% elif lr == "player" or lr == "player won" or lr == "player_win" or lr == "loss" %}
                <div class="gr-pill"><span class="gr-badge gr-badge-bad">Last Result: PLAYER WON</span></div>
              {% else %}
                <div class="gr-pill"><span class="gr-badge gr-badge-warn">Last Result: DRAW</span></div>
              {% endif %}
            {% else %}
              <div class="gr-pill"><span class="gr-badge gr-badge-warn">No games yet</span></div>
            {% endif %}
          </div>
        </div>

        <div class="gr-hero-right">
          <div class="gr-mini-card">
            <div class="gr-mini-k">AI Wins</div>
            <div class="gr-mini-v">{{ report.ai_wins }}</div>
          </div>
          <div class="gr-mini-card">
            <div class="gr-mini-k">Player Wins</div>
            <div class="gr-mini-v">{{ report.player_wins }}</div>
          </div>
          <div class="gr-mini-card">
            <div class="gr-mini-k">Draws</div>
            <div class="gr-mini-v">{{ report.draws }}</div>
          </div>
        </div>
      </section>

      {% set lg = report.last_game %}
      {% set hist = report.history %}

      <!-- Main grid -->
      <section class="gr-grid">
        <!-- Overall -->
        <div class="gr-card">
          <div class="gr-card-head">
            <h2>Overall Performance</h2>
            <div class="gr-chip">Minimax</div>
          </div>

          <div class="gr-table">
            <div class="gr-row"><div class="gr-k">Total games</div><div class="gr-v">{{ report.games_played }}</div></div>
            <div class="gr-row"><div class="gr-k">AI wins</div><div class="gr-v">{{ report.ai_wins }}</div></div>
            <div class="gr-row"><div class="gr-k">Player wins</div><div class="gr-v">{{ report.player_wins }}</div></div>
            <div class="gr-row"><div class="gr-k">Draws</div><div class="gr-v">{{ report.draws }}</div></div>
            <div class="gr-row"><div class="gr-k">AI win rate</div><div class="gr-v">{{ report.ai_win_rate }}%</div></div>
            <div class="gr-row"><div class="gr-k">Current minimax depth</div><div class="gr-v">{{ report.current_depth }}</div></div>
          </div>

          <div class="gr-callout">
            Depth increases as the agent becomes more confident (based on history + detected patterns).
          </div>
        </div>

        <!-- Last game -->
        <div class="gr-card">
          <div class="gr-card-head">
            <h2>Last Game Breakdown</h2>
            <div class="gr-chip">Recent</div>
          </div>

          <div class="gr-table">
            <div class="gr-row"><div class="gr-k">Result</div><div class="gr-v">{{ lg.result | capitalize }}</div></div>
            <div class="gr-row"><div class="gr-k">AI moves played</div><div class="gr-v">{{ lg.moves }}</div></div>
            <div class="gr-row"><div class="gr-k">Estimated mistakes</div><div class="gr-v">{{ lg.mistakes }}</div></div>
            <div class="gr-row"><div class="gr-k">Estimated blunders</div><div class="gr-v">{{ lg.blunders }}</div></div>

            <div class="gr-row">
              <div class="gr-k">Efficiency</div>
              <div class="gr-v">
                {% if lg.efficiency is not none %}
                  {{ (lg.efficiency * 100) | round(1) }}%
                {% else %}
                  N/A
                {% endif %}
              </div>
            </div>

            <div class="gr-row"><div class="gr-k">Avg search depth</div><div class="gr-v">{{ lg.avg_depth | round(2) }}</div></div>
          </div>
        </div>

        <!-- History -->
        <div class="gr-card">
          <div class="gr-card-head">
            <h2>Historical Averages</h2>
            <div class="gr-chip">Trends</div>
          </div>

          <div class="gr-table">
            <div class="gr-row"><div class="gr-k">Games in history</div><div class="gr-v">{{ hist.total_games }}</div></div>
            <div class="gr-row"><div class="gr-k">Avg mistakes / game</div><div class="gr-v">{{ hist.avg_mistakes | round(2) }}</div></div>
            <div class="gr-row"><div class="gr-k">Avg blunders / game</div><div class="gr-v">{{ hist.avg_blunders | round(2) }}</div></div>
            <div class="gr-row"><div class="gr-k">Avg efficiency</div><div class="gr-v">{{ (hist.avg_efficiency * 100) | round(1) }}%</div></div>
            <div class="gr-row"><div class="gr-k">Avg search depth</div><div class="gr-v">{{ hist.avg_depth | round(2) }}</div></div>
          </div>
        </div>

        <!-- Player behavior bars -->
        <div class="gr-card">
          <div class="gr-card-head">
            <h2>Learned Player Behaviour</h2>
            <div class="gr-chip">Columns</div>
          </div>

          {% if report.player_column_bars %}
            <div class="gr-bars">
              {% for item in report.player_column_bars %}
                <div class="gr-bar-row">
                  <div class="gr-bar-label">Col {{ item.col }}</div>

                  <div class="gr-bar-track">
                    <div class="gr-bar-fill" style="--w: {{ item.width_css }};"></div>
                  </div>

                  <div class="gr-bar-value">{{ item.count }}</div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="gr-muted">No moves recorded yet.</p>
          {% endif %}
        </div>
      </section>

      <!-- Footer explainer -->
      <section class="gr-footer-card" style="margin-top:14px;">
        <h2>Learnings from the game </h2>
        <div class="gr-note-grid">
  <div class="gr-note">
    Mistakes are moves after which the evaluation worsens for the AI.
    Larger drops are counted as blunders.
  </div>
  <div class="gr-note">
    Efficiency stays closer to 100% when the AI plays consistently strong moves
    with fewer mistakes/blunders.
  </div>
  <div class="gr-note">
    This can be presented as a multi-agent AI system: one agent plays (minimax),
    one analyzes patterns, and one reports performance.
  </div>
  <div class="gr-note">
    Increasing search depth is a form of adaptive difficulty: deeper search â†’ stronger play
    but slower computation.
  </div>
</div>

        <div class="gr-bottom-actions">
          <a class="gr-btn gr-btn-primary" href="{{ url_for('connect4') }}">Play Again</a>
          <a class="gr-btn gr-btn-ghost" href="{{ url_for('index') }}">Back to Main Menu</a>
        </div>
      </section>
    </div>
  </body>
</html>
