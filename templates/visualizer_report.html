<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Visualizer - AI Report</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/visualizer_report.css') }}" />
  </head>
  <body>
    <!-- AI Loading Overlay -->
    <div id="aiLoadingOverlay">
      <div class="loading-box">
        <img src="{{ url_for('static', filename='assets/icons/robo_icon.png') }}" alt="AI Agent" />
        <h3 class="loading-title">AI Agent is analyzing your run…</h3>
        <p class="loading-sub">Extracting metrics • Comparing strategies • Writing insights</p>
      </div>
    </div>

    <div class="report-wrap">
      <div class="report-header">
        <div class="header-left">
          <img class="robo" src="{{ url_for('static', filename='assets/icons/robo_icon.png') }}" alt="AI Agent" />
          <div class="header-title">
            <h1>Visualizer AI Agent Report</h1>
            <p>Multi-agent analysis of your algorithm run (metrics + explanations + learning outcomes).</p>
          </div>
        </div>
        <div>
          <a class="btn btn-gray" href="{{ url_for('visualizer') }}">⬅ Back</a>
          <a class="btn btn-yellow" href="{{ url_for('index') }}">Main Menu</a>
        </div>
      </div>

      {% if not report %}
        <div class="card" style="margin-top:16px;">
          <h2>No run found</h2>
          <p>Run a visualization first, then open the report from the “View AI explanation report →” link.</p>
        </div>
      {% else %}
        <div class="card" style="margin-top:16px;">
          <h2>{{ report.title }}</h2>
          <p style="opacity:0.9; margin: 8px 0 0;">{{ report.high_level }}</p>
        </div>

        <div class="grid-2">
          <div class="card">
            <h2>Run Overview</h2>
            <div class="kv">
              <div class="k">Algorithm</div><div class="v">{{ report.algorithm }}</div>
              <div class="k">Heuristic</div><div class="v">{{ report.heuristic }}</div>

              <div class="k">Found Path</div>
              <div class="v">
                {% if report.metrics and report.metrics.path_length and report.metrics.path_length > 0 %}
                  <span class="badge badge-ok">YES</span>
                {% else %}
                  <span class="badge badge-bad">NO</span>
                {% endif %}
              </div>

              <div class="k">Nodes Expanded</div><div class="v">{{ report.metrics.nodes_expanded }}</div>
              <div class="k">Path Length</div><div class="v">{{ report.metrics.path_length }}</div>
              <div class="k">Visited / Step</div><div class="v">{{ report.metrics.efficiency_visited_per_step }}</div>
              <div class="k">Detour Ratio</div><div class="v">{{ report.metrics.detour_ratio_vs_manhattan }}</div>
              <div class="k">Revisit Rate (%)</div><div class="v">{{ report.metrics["revisit_rate_%"] }}</div>
            </div>
          </div>

          <div class="card">
            <h2>What you learned</h2>
            <ul>
              {% for s in report.learning_outcomes %}
                <li>{{ s }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <div class="card" style="margin-top:16px;">
          <h2>Multi-Agent Insights</h2>
          <div class="agent-list">
            {% for sec in report.agent_sections %}
              <div class="card agent-card">
                <h3>{{ sec.agent_title }}</h3>
                <p>{{ sec.summary }}</p>
                <ul>
                  {% for i in sec.insights %}
                    <li>{{ i }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endfor %}
          </div>
        </div>

        <div class="card" style="margin-top:16px;">
          <h2>Study Notes (for viva / report writing)</h2>
          <ul>
            {% for note in report.study_notes %}
              <li>{{ note }}</li>
            {% endfor %}
          </ul>
        </div>

        <div class="footer-actions">
          <a class="btn btn-yellow" href="{{ url_for('visualizer') }}">Run another visualization</a>
          <a class="btn btn-gray" href="{{ url_for('index') }}">Back to Main Menu</a>
        </div>
      {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/visualizer/report_loader.js') }}"></script>
  </body>
</html>
